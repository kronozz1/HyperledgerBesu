"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.onMessageReceived = void 0;
const helpers_1 = require("../../helpers");
const types_1 = require("../../types");
const ResponseMessage_1 = require("../ResponseMessage");
/**
 * Unmarshalls the message value and emit an enriched message event
 *
 * @param payload Kafka message
 * @param consumer Orchestrate Consumer
 */
function onMessageReceived(payload, consumer) {
    var _a;
    const { topic, partition, message } = payload;
    const responseMessage = new ResponseMessage_1.ResponseMessage(consumer, Object.assign(Object.assign({}, message), { key: (_a = message.key) === null || _a === void 0 ? void 0 : _a.toString(), value: helpers_1.unmarshalEnvelope(message.value), topic,
        partition }));
    consumer.emit(types_1.EventType.Response, responseMessage);
}
exports.onMessageReceived = onMessageReceived;
